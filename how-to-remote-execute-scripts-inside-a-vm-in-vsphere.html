
<!DOCTYPE html>
<html lang="en-US">
<!-- Including the Head tag and metadata -->



<head><meta name="generator" content="Hexo 3.8.0">
  <!--Meta-->
    <meta charset="UTF-8">
    <!-- <title>How to Remote execute scripts inside a VM in vSphere-Deciphering Clouds</title> -->
    <title>Deciphering Clouds</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=5.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Here you will find posts on various VMware and other technologies including but not limited to vRealize Suite, NSX, VSAN, PowerCLI, Python, and DevOps. A special focus is on vRA, vROps and vRO">
    <meta name="author" content="Sajal Debnath">
    <link rel="icon" href="/images/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/clr-ui.min.css">
    <style>
      .responsive {
        max-width: 100%;
        height: auto;
      }
      .video-container {
        position: relative;
        padding-bottom: 56.25%;
        padding-top: 30px; height: 0; overflow: hidden;
      }
      .video-container iframe,
      .video-container object,
      .video-container embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


<body>
<!--  <main> body starts from here-->
  <clr-main-container class="main-container">
    <!-- Blog Header Navigation and Subnav menus -->
    
<!-- <header class="header header-4"> -->

<clr-header class="header-6 header">
  <!---->
  <button class="header-hamburger-trigger" type="button" aria-label="HeaderMenu">
    <span></span>
  </button>
  <div class="branding">
      <a class="logo-and-title" href="/">
          <span><img src="/images/Logo.png" alt="Logo" width="36" height="36"></span>
          <span class="title">Deciphering Clouds</span>
      </a>
  </div>
  <div class="divider"></div>
  <ul class="header-nav list-unstyled clr-nav-level-1">
    <li class="nav-item">
      <a href="/" class="nav-link nav-text">Home</a>
    </li>
      <!---->
      <li class="nav-item">
        <a href="/about/" class="nav-link nav-text">About</a>
      </li>
        <!---->
      <li class="nav-item">
        <a href="/contact/" class="nav-link nav-text">Contact</a>
      </li><li>
      </li><li class="nav-item">
        <a href="/archives/" class="nav-link nav-text">Archives</a>
      </li><li>
  </li></ul>
</clr-header>


    <!-- Content container starts from here-->
    <!-- Dividing the content area into two different part. First part will Show
      Post and Page related information. Right side will have widgets -->
      

<div class="content-container">
  <div class="content-area">
    <div class="clr-row clr-align-items-start">
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-3">
        <!-- Left side space -->
      </div>
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-6">
        <div class="card">
   <div class="card-header">
      <h3 class="card-title">
        <div class="clr-row clr-align-items-start">
          <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-9 clr-col-xl-9">
            How to Remote execute scripts inside a VM in vSphere
          </div>
          <!-- Right Side Space -->
          <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-3 clr-col-xl-3 clr-justify-content-end">
            <img border="0" alt="Home" src="/share-solid.svg" width="18" height="18">
<a class="card-link" href="http://www.facebook.com/sharer.php?u=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Facebook" src="/facebook.svg" width="18" height="18">
</a>
<a class="card-link" href="http://www.linkedin.com/shareArticle?mini=true&url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="LinkedIn" src="/linkedin.svg" width="18" height="18">
</a>
<a class="card-link" href="http://twitter.com/intent/tweet?text=An%20intersting%20blog&url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Twitter" src="/twitter.svg" width="18" height="18">
</a>
<a class="card-link" href="https://plus.google.com/share?url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Goolge+" src="/google-plus.svg" width="18" height="18">
</a>

            &emsp;
            <a href="/"><img border="0" alt="Home" src="/home-solid.svg" width="18" height="18"></a>
          </div>
        </div>
      </h3>
   </div>
   <div class="card-block">
     
        


Related Categories: <a href="/categories/Virtualization-Cloud/">#Virtualization & Cloud</a> <a href="/categories/Virtualization-Cloud/Automation/">#Automation</a> &nbsp &nbsp &nbsp &nbsp <img border="0" alt="Info-Standard" src="/calendar-line.svg" width="18" height="18"> 2015-12-04



     
   <div class="card-text">
         <!-- Content -->
      <h4 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h4><p>Hello All,<br>Hope you are doing well. Today I want to talk about remotely executing scripts inside a VM which is hosted in vSphere environment. Recently I received the following requirement from a colleague for a customer.<br> <a id="more"></a></p>
<p><strong>Environment:</strong>  </p>
<ol>
<li>Customer has hundreds of VMs  </li>
<li>A particular application is running in many of the VM’s which creates a log file in a particular location inside the VM  </li>
<li>Admin team does not know in which of those VM’s the application is running  </li>
</ol>
<p><strong>Requirement:</strong>  </p>
<ol>
<li>Admin team wants to know in which of those VM’s the application is running.  </li>
<li>They want to get the information in an excel file  </li>
</ol>
<p><strong>Solution:</strong>  </p>
<p>To provide a solution to this problem we would use the <strong>Invoke-Command</strong> cmdlet available in PowerShell. Note I used this cmdlet as all the VM’s had <strong>Windows</strong> as an operating system. For more generic work (mixed environment) we can use <strong>Invoke-VMScript</strong> cmdlet available in PowerShell.  </p>
<p>The difference between the two is given below:  </p>
<blockquote>
<p>Invoke-Command is a more specific cmdlet which works for Windows environment only. This cmdlet let’s you run a command in the “local or remote” windows computers (be it physical or virtual).  </p>
</blockquote>
<blockquote>
<p>On the contrary Invoke-VMScript is a very specific cmdlet provided with PowerCLI which is applicable for vSphere environment only. This cmdlet “Runs a script in the guest OS of each of the specified virtual machines” and this is valid of all guest operating system. This actually takes help of VMware tools to run the script remotely.  </p>
</blockquote>
<p>For my example, I took help of <strong>Invoke-Command</strong> and had written the following script.  </p>
<pre class=" language-powershell"><code class="language-powershell">
<span class="token comment" spellcheck="true">#requires -version 3  </span>

<span class="token comment" spellcheck="true">###########################################################################################  </span>
\<span class="token comment" spellcheck="true"># Title     :   Finding a list of VMs in which a particular file is present  </span>
\<span class="token comment" spellcheck="true"># Filename  :   Get-File.ps1            </span>
\<span class="token comment" spellcheck="true"># Created by:   Sajal Debnath             </span>
\<span class="token comment" spellcheck="true"># Date      :   19-11-2015                  </span>
\<span class="token comment" spellcheck="true"># Version   :   1.0          </span>
\<span class="token comment" spellcheck="true"># Update    :   This is the first version  </span>
\<span class="token comment" spellcheck="true"># E-mail    :   sdebnath@vmware.com  </span>
<span class="token comment" spellcheck="true">###########################################################################################  </span>

<span class="token comment" spellcheck="true">&lt;# .synopsis="" get-file="" finds="" whether="" a="" particular="" file="" is="" present="" in="" location="" inside="" windows="" vm="" .description="" get-file.ps1="" script="" to="" find="" out="" list="" of="" all="" the="" vm's="" vsphere="" envionment="" which="" location.="" output="" provided="" console="" or="" optionally="" can="" be="" saved="" csv="" format="" works="" on="" powered="" and="" only="" those="" where="" vmware="" tools="" installed.="" run="" with="" following="" parameters="" -vcenter="" &lt;vcenter=""> -vcuser &lt;vcenter user=""> -vcpassword &lt;vcenter password=""> -guestuser &lt;guest os="" user="" id=""> -guestpassword &lt;guest user="" password=""> -filelocation &lt;location of="" the="" file=""> -outputfile &lt;output file="" location="">  

    .NOTES   
   Created by: Sajal Debnath   
   Modified: 19/11/2015 10:29:58 PM    

   Changelog:   
    \*    


   To Do:   
    *   


    .EXAMPLE   


#></span>   

<span class="token keyword">Param</span><span class="token punctuation">(</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$vcenter</span><span class="token punctuation">,</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$vcuser</span><span class="token punctuation">,</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$vcpassword</span><span class="token punctuation">,</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$guestuser</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$guestpassword</span>  
    \<span class="token namespace">[Parameter (Mandatory=$true, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$filelocation</span>  
    \<span class="token namespace">[Parameter (Mandatory=$false, ValueFromPipeline=$false)\]</span>  
    \<span class="token namespace">[String\]</span><span class="token variable">$outputfile</span>  
<span class="token punctuation">)</span>  

<span class="token keyword">Begin</span><span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true"># Adding Snapin and Importing required Modules  </span>
    <span class="token variable">$snapinName</span> = <span class="token string">'VMware.VimAutomation.Core'</span>  
    <span class="token variable">$snapinAdded</span> = <span class="token function">Get-PSSnapin</span> <span class="token punctuation">|</span> <span class="token function">Select-String</span> <span class="token variable">$snapinName</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$snapinAdded</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{</span>  
        <span class="token function">Add-PSSnapin</span> <span class="token variable">$snapinName</span>  
    <span class="token punctuation">}</span>  


    <span class="token keyword">Try</span><span class="token punctuation">{</span>  
        <span class="token function">Write-Verbose</span> <span class="token string">'Connecting to vCenter Server'</span>  
        \<span class="token namespace">[void\]</span> <span class="token punctuation">(</span>Connect<span class="token operator">-</span>VIServer <span class="token operator">-</span>Server <span class="token variable">$vcenter</span> <span class="token operator">-</span>User <span class="token variable">$vcuser</span> <span class="token operator">-</span>Password <span class="token variable">$vcpassword</span><span class="token punctuation">)</span>  
        <span class="token variable">$vcfullname</span> = <span class="token punctuation">(</span>Get<span class="token operator">-</span>View ServiceInstance<span class="token punctuation">)</span><span class="token punctuation">.</span>Content<span class="token punctuation">.</span>About<span class="token punctuation">.</span>FullName  
    <span class="token punctuation">}</span>  

    <span class="token keyword">Catch</span><span class="token punctuation">{</span>  
        <span class="token function">Write-Debug</span> <span class="token string">'Could Not Connect to vCenter Server'</span>  
        <span class="token keyword">Exit</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  

<span class="token keyword">Process</span> <span class="token punctuation">{</span>  

        <span class="token comment" spellcheck="true"># Collecting all the VM's that are poweredon and has VMware tools installed in it  </span>
        <span class="token variable">$vms</span> = Get<span class="token operator">-</span>VM <span class="token punctuation">|</span> Where <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">.</span>PowerState <span class="token operator">-eq</span> <span class="token string">'PoweredOn'</span><span class="token punctuation">)</span> <span class="token operator">-and</span> <span class="token punctuation">(</span><span class="token variable">$_</span><span class="token punctuation">.</span>ExtensionData<span class="token punctuation">.</span>Summary<span class="token punctuation">.</span>Guest<span class="token punctuation">.</span>ToolsStatus <span class="token operator">-eq</span> <span class="token string">'toolsOk'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  

        <span class="token variable">$information</span> = @<span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$vm</span> in <span class="token variable">$vms</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
        <span class="token variable">$info</span> = <span class="token string">""</span><span class="token punctuation">|</span> <span class="token function">Select</span> Name<span class="token punctuation">,</span>Status  
        <span class="token variable">$body</span> = <span class="token function">Invoke-Command</span> <span class="token operator">-</span>ComputerName <span class="token variable">$vm</span> <span class="token operator">-</span>ScriptBlock <span class="token punctuation">{</span><span class="token function">Dir</span> <span class="token variable">$filelocation</span><span class="token punctuation">}</span> <span class="token operator">-</span>GuestUser <span class="token variable">$guestuser</span> <span class="token operator">-</span>GuestPassword <span class="token variable">$guestpassword</span> <span class="token operator">-</span>ErrorAction SilentlyContinue  
        <span class="token variable">$info</span><span class="token punctuation">.</span>Name = <span class="token variable">$vm</span><span class="token punctuation">.</span>Name  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$body</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
            <span class="token variable">$info</span><span class="token punctuation">.</span>Status = <span class="token string">'File Exists'</span>  
        <span class="token punctuation">}</span>  
        <span class="token keyword">Else</span><span class="token punctuation">{</span>  
            <span class="token variable">$info</span><span class="token punctuation">.</span>Status = <span class="token string">'File Does Not Exist'</span>  
        <span class="token punctuation">}</span>  
        <span class="token variable">$information</span> <span class="token operator">+=</span> <span class="token variable">$info</span>   
        <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  


<span class="token keyword">End</span> <span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true"># Showing in the information in screen and if path provided then saving it in file  </span>
        <span class="token function">Write-Host</span> <span class="token variable">$information</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$outputfile</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  
            <span class="token variable">$information</span> <span class="token punctuation">|</span> <span class="token function">Export-Csv</span> <span class="token operator">-</span>Path <span class="token variable">$outputfile</span> <span class="token operator">-</span>NoTypeInformation  
        <span class="token punctuation">}</span>  
        Disconnect<span class="token operator">-</span>VIServer <span class="token operator">-</span>server <span class="token variable">$vcenter</span> <span class="token operator">-</span>Confirm:<span class="token boolean">$false</span>  
<span class="token punctuation">}</span>  

&lt;<span class="token operator">/</span>output>&lt;<span class="token operator">/</span>location>&lt;<span class="token operator">/</span>guest>&lt;<span class="token operator">/</span>guest>&lt;<span class="token operator">/</span>vcenter>&lt;<span class="token operator">/</span>vcenter>&lt;<span class="token operator">/</span><span class="token comment" spellcheck="true">#></span></code></pre>



<p>The above script will check inside all the VM’s for the presence of the file inside the VM and generate an excel file based on the finding.  </p>
<p>You can run the script in the following format.  </p>
<pre class=" language-powershell"><code class="language-powershell">
Get<span class="token operator">-</span>File <span class="token operator">-</span>vcenter &lt;vcenter> <span class="token operator">-</span>vcuser &lt;vcenter user=<span class="token string">""</span>> <span class="token operator">-</span>vcpassword &lt;vcenter password=<span class="token string">""</span>> <span class="token operator">-</span>guestuser &lt;guest os=<span class="token string">""</span> user=<span class="token string">""</span> id=<span class="token string">""</span>> <span class="token operator">-</span>guestpassword &lt;guest user=<span class="token string">""</span> password=<span class="token string">""</span>> <span class="token operator">-</span>filelocation &lt;location of=<span class="token string">""</span> the=<span class="token string">""</span> file=<span class="token string">""</span>> <span class="token operator">-</span>outputfile &lt;output file=<span class="token string">""</span> location=<span class="token string">""</span>>
&lt;<span class="token operator">/</span>output>&lt;<span class="token operator">/</span>location>&lt;<span class="token operator">/</span>guest>&lt;<span class="token operator">/</span>guest>&lt;<span class="token operator">/</span>vcenter>&lt;<span class="token operator">/</span>vcenter>&lt;<span class="token operator">/</span>vcenter></code></pre>
   </div>
  </div>
     <div class="card-footer">
       <div class="clr-row clr-align-items-start">
         <div class="clr-col-xs-11 clr-col-sm-11 clr-col-md-11 clr-col-lg-11 clr-col-xl-11">
           <b>Share: &emsp; </b>
<a class="card-link" href="http://www.facebook.com/sharer.php?u=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Facebook" src="/facebook.svg" width="25" height="25">
</a>
<a class="card-link" href="http://www.linkedin.com/shareArticle?mini=true&url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="LinkedIn" src="/linkedin.svg" width="25" height="25">
</a>
<a class="card-link" href="http://twitter.com/intent/tweet?text=An%20intersting%20blog&url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Twitter" src="/twitter.svg" width="25" height="25">
</a>
<a class="card-link" href="https://plus.google.com/share?url=https://sajaldebnath.com/how-to-remote-execute-scripts-inside-a-vm-in-vsphere.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Goolge+" src="/google-plus.svg" width="25" height="25">
</a>

         </div>
         <!-- Right Side Space -->
         <div class="clr-col-xs-1 clr-col-sm-1 clr-col-md-1 clr-col-lg-1 clr-col-xl-1 clr-justify-content-end">
           <a href="/"><img border="0" alt="Home" src="/home-solid.svg" width="18" height="18"></a>
         </div>
       </div>
     </div>
</div>
<!-- Comments Section -->

<section class="comments">
  <div class="card">
    <div class="card-header">
      <b>Comments</b>
    </div>
    <div class="card-block">
      <div class="card-text">
        
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>


      </div>
    </div>
  </div>
</section>


      </div>
      <!-- Right Side Space -->
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-3">
        <div class="card">
          <div class="card-header">
              <h3 class="card-title">Table of Contents</h3>
          </div>
          <div class="card-block">
            <div class="card-text">
              <ol class="list"><li class="list-item list-level-4"><a class="list-link" href="#Purpose"><span class="list-text">Purpose</span></a></li></ol>
            </div>
          </div>
        </div>
      </div>
  </div>
</div>
</div>


  </clr-main-container>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-84051711-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-84051711-1');
  gtag('set', {'user_id': 'UA-84051711-1'}); // Set the user ID using signed-in user_id.
</script>

  <!-- Including the Scripts Area -->
  <script src="/js/jquery-3.3.1.slim.min.js" async></script>
  <script>window.jQuery || document.write('<script src="/js/jquery-3.3.1.slim.min.js"><\/script>')</script>
  <script src="/js/search.js"></script>

  <noscript>
    Sorry...JavaScript is needed to go ahead.
  </noscript>

<!-- Local Search Function    -->

  
     <script type="text/javascript">
       var search_path = "search.xml";
  	 if (search_path.length == 0) {
  	 	search_path = "search.xml";
  	 }
  	 var path = "/" + search_path;
       searchFunc(path, 'local-search-input', 'local-search-result');
     </script>
  
  
  <!-- Defining the scripts -->
  <script type="text/javascript">

    // Handling the main header menubar options in Responsive mode
    $(".header-hamburger-trigger").on('click',function(){
      if($(".main-container").hasClass("open-hamburger-menu")){
        $(".main-container").removeClass("open-hamburger-menu");
      }else{
      $(".main-container").addClass("open-hamburger-menu");
    }
    });

  </script>
  <!-- Disqus Comments -->
  
    <script type="text/javascript">
        var disqus_shortname = 'sajaldebnath';
        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>
  

</body>
</html>
