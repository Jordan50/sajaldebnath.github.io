
<!DOCTYPE html>
<html lang="en-US">
<!-- Including the Head tag and metadata -->


<head><meta name="generator" content="Hexo 3.8.0">
  <!--Meta-->
    <meta charset="UTF-8">
    <title>OOTB Shared DB as a Service complete with Day 2 Operations-Anything Virtual and Cloudy</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=5.0">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Here you will find posts on various VMware and other technologies including but not limited to vRealize Suite, NSX, VSAN, PowerCLI, Python, and DevOps. A special focus is on vRA, vROps and vRO">
    <meta name="author" content="Sajal Debnath">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/clr-ui.min.css">
    <style>
      .responsive {
        max-width: 100%;
        height: auto;
      }
      .video-container {
        position: relative;
        padding-bottom: 56.25%;
        padding-top: 30px; height: 0; overflow: hidden;
      }
      .video-container iframe,
      .video-container object,
      .video-container embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>
<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


<body>
<!--  <main> body starts from here-->
  <clr-main-container class="main-container">
    <!-- Blog Header Navigation and Subnav menus -->
    
<!-- <header class="header header-4"> -->

<clr-header class="header-6 header">
  <!---->
  <button class="header-hamburger-trigger" type="button" aria-label="HeaderMenu">
    <span></span>
  </button>
  <div class="branding">
      <a class="logo-and-title" href="/">
          <span><img src="/images/logo.png" alt="Logo" width="36" height="36"></span>
          <span class="title">Anything Virtual and Cloudy</span>
      </a>
  </div>
  <div class="divider"></div>
  <ul class="header-nav list-unstyled clr-nav-level-1">
    <li class="nav-item">
      <a href="/" class="nav-link nav-text">Home</a>
    </li>
      <!---->
      <li class="nav-item">
        <a href="/about/" class="nav-link nav-text">About</a>
      </li>
        <!---->
      <li class="nav-item">
        <a href="/contact/" class="nav-link nav-text">Contact</a>
      </li><li>
      </li><li class="nav-item">
        <a href="/archives/" class="nav-link nav-text">Archives</a>
      </li><li>
        <!---->
  </li></ul>
  <!---->
</clr-header>

    <!-- Content container starts from here-->
    <!-- Dividing the content area into two different part. First part will Show
      Post and Page related information. Right side will have widgets -->
      
          

<div class="content-container">
  <div class="content-area">
    <div class="clr-row clr-align-items-start">
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-3">
        <!-- Left side space -->
      </div>
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-6">
        <div class="card">
   <div class="card-header">
      <h3 class="card-title">
        <div class="clr-row clr-align-items-start">
          <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-9 clr-col-xl-9">
            OOTB Shared DB as a Service complete with Day 2 Operations
          </div>
          <!-- Right Side Space -->
          <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-3 clr-col-xl-3 clr-justify-content-end">
            <img border="0" alt="Home" src="/share-solid.svg" width="18" height="18">
<a class="card-link" href="http://www.facebook.com/sharer.php?u=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Facebook" src="/facebook.svg" width="18" height="18">
</a>
<a class="card-link" href="http://www.linkedin.com/shareArticle?mini=true&url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="LinkedIn" src="/linkedin.svg" width="18" height="18">
</a>
<a class="card-link" href="http://twitter.com/intent/tweet?text=An%20intersting%20blog&url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Twitter" src="/twitter.svg" width="18" height="18">
</a>
<a class="card-link" href="https://plus.google.com/share?url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Goolge+" src="/google-plus.svg" width="18" height="18">
</a>

            &emsp;
            <a href="/"><img border="0" alt="Home" src="/home-solid.svg" width="18" height="18"></a>
          </div>
        </div>
      </h3>
   </div>
   <div class="card-block">
     
        


Related Categories: <a href="/categories/vRealize-Suite/">#vRealize Suite</a> <a href="/categories/vRealize-Suite/vRealize-Automation/">#vRealize Automation</a> <a href="/categories/vRealize-Suite/vRealize-Orchestrator/">#vRealize Orchestrator</a> &nbsp &nbsp &nbsp &nbsp <img border="0" alt="Info-Standard" src="/calendar-line.svg" width="18" height="18"> 2017-08-21



     
   <div class="card-text">
         <!-- Content -->
      <h4 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h4><p>The [first part of the post]<a href="/out-of-the-box-shared-db-as-a-service-in-vrealize-automation.html" title="Out-of-the-box shared DB-as-a-Service in vRealize Automation">Out-of-the-box shared DB-as-a-Service in vRealize Automation</a> dealt with “Out of the box Shared DB as a Service”. In addition to other points, where I explained about Shared DB as a Service using a vRO package. Limitation of that package is, it only creates the DB in real Database. Created databases do not appear in vRA items list.<br><a id="more"></a><br>Also any Day 2 operation is not possible on the created Databases. While this post provides a complete package which adds the created databases as items in vRA. In addition, supports all Day 2 operations. Also now the package provides actions for out of the box Day 2 operations. This post details about that package.</p>
<h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction:"></a>Introduction:</h4><p>I received a lot of good feedback on the first version of the package. Also, I received many requests for making it fully functional. In its current form, it is very basic. Only creating shared databases in the database server actually achieves not much. So, I decided to take it further and give a complete feature set. Making it ideal for proof of concept environments. The functionalities are all there. The only point is, it is not fully tested for all the gotchas. So feel free to update the original workflows and packages.</p>
<h4 id="How-Shared-DB-as-a-Service-package-works"><a href="#How-Shared-DB-as-a-Service-package-works" class="headerlink" title="How Shared DB as a Service package works:"></a>How Shared DB as a Service package works:</h4><p>Like the [original package]<a href="/out-of-the-box-shared-db-as-a-service-in-vrealize-automation.html" title="Out-of-the-box shared DB-as-a-Service in vRealize Automation">Out-of-the-box shared DB-as-a-Service in vRealize Automation</a> , this time also all the workflows are available as a single package with the name <strong>“com.vmware.db-as-a-service-v3.package”</strong>. Please follow thebelow mentioned steps to import and run the workflows.</p>
<ul>
<li>Login to vRO client and go to Admin mode</li>
<li>Import the package in the Package manager</li>
<li>Once imported, go to Design mode.</li>
<li>You can find a new folder with the name “Database-as-a-Service”. Expand it and you can find the workflow “Setup Database-as-a-Service Environment”</li>
<li>Run this workflow and this will setup the entire environment</li>
</ul>
<p>Folder structure: </p>
<p><img src="/images/2017/08/Folder-Structure.png" alt="Shared DB as a Service folder structure" class="responsive"></p>
<h4 id="Important-Information"><a href="#Important-Information" class="headerlink" title="Important Information:"></a>Important Information:</h4><p>Before you can run the workflows please check the important information provided below:</p>
<ul>
<li>In the vRO server you need to add vRA CAFE and IaaS server as an endpoint.</li>
<li>vCenter server where the Database VM’s live, needs to be added as an endpoint in vRO. All these are mentioned in the video.</li>
<li>After the workflow run, log into vRA portal, go to <strong>Design –&gt; XaaS –&gt; Resource Actions –&gt; Select “Delete a Database”</strong>. Edit this action. In the second page select “Destroy”.</li>
<li>There was a knows issue with MySQL connector for vRO in vRA 7.2. I found the same issue in vRA 7.3 as well. Please check this <a href="https://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2148277" rel="external nofollow noopener noreferrer" target="_blank">VMware KB Article</a> to solve the issue.</li>
</ul>
<h4 id="Known-limitations"><a href="#Known-limitations" class="headerlink" title="Known limitations:"></a>Known limitations:</h4><p>The following limitation is there in the current form.</p>
<ul>
<li>While creating the databases, the workflow does not check whether the user already exists or not. It only checks for the Database existence</li>
<li>If a user already exists, then the database creation will fail</li>
<li>While deleting the database, the user is also deleted</li>
<li>MySQL database name does not support ‘-‘ in the name</li>
</ul>
<p>The above happens because of the assumption that a single user will create a single database. Clearly, this is a limitation. To remove this limitation, I need to update the Database creation scripts. At this stage, my primary focus is to give the functionalities. Anyone requiring more flexibility, please update the core scripts for database creations. In the video, I have covered how you can change the scripts.</p>
<h4 id="Database-creation-scripts"><a href="#Database-creation-scripts" class="headerlink" title="Database creation scripts:"></a>Database creation scripts:</h4><p>I am no authority on these databases. I created and configured the databases the quickest and easiest way. These do not conform the best practices :). These are applicable to a PoC environment only. Provided below are the steps for setting up the database environment.</p>
<h4 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL:"></a><strong>PostgreSQL:</strong></h4><p>I used CentOS 7.3 as base OS. Install steps:</p>
<pre class=" language-bash"><code class="language-bash">
yum <span class="token function">install</span> postgresql*

systemctl start postgresql.service
systemctl status postgresql.service
systemctl <span class="token function">enable</span> postgresql.service
/usr/bin/postgresql-setup initdb
<span class="token function">vi</span> /var/lib/pgsql/data/pg_hba.conf
</code></pre>

<p>In the <strong>pg_hba.conf</strong> file check for the below lines and make changes as per your requirement</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token comment" spellcheck="true"># "local" is for Unix domain socket connections only</span>
local   all             all                                     trust

<span class="token comment" spellcheck="true"># IPv4 local connections:</span>
host    all             all             127.0.0.1/32            ident
host    all             all             0.0.0.0/0         trust
</code></pre>

<p>Note, I gave all permission to everyone in the local machine. Also, I trusted everyone from everyone. Next, modify postgresql.conf file.</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token function">vi</span> /var/lib/pgsql/data/postgresql.conf
</code></pre>


<p>And made the following change</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token comment" spellcheck="true">#listen_addresses = 'localhost'         # what IP address(es) to listen on;</span>
listen_addresses <span class="token operator">=</span> <span class="token string">'*'</span>
</code></pre>

<p>Finally ran the following:</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token function">service</span> postgresql restart
systemctl disable firewalld
systemctl stop firewalld
systemctl status firewalld
</code></pre>

<p><strong>Creating the Database:</strong></p>
<pre class=" language-bash"><code class="language-bash">
<span class="token function">sudo</span> -u postgres psql -c <span class="token string">"CREATE USER usr WITH PASSWORD 'passwd'"</span>
<span class="token function">su</span> - postgres -c <span class="token string">"createdb testdb -O usr"</span>
</code></pre>

<p>Used pgAdmin version 4 as the front-end management component for managing PostgreSQL databases.</p>
<h4 id="MySQL-DB"><a href="#MySQL-DB" class="headerlink" title="MySQL DB:"></a>MySQL DB:</h4><pre class=" language-bash"><code class="language-bash">
<span class="token function">wget</span> https://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm
rpm -ivh mysql57-community-release-el7-9.noarch.rpm
yum <span class="token function">install</span> mysql-server
systemctl start mysqld
systemctl status mysqld
systemctl <span class="token function">enable</span> mysqld
<span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log
mysql\_secure\_installation
mysqladmin -u root -p version
</code></pre>

<p>Edited my.cnf file with</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token function">vi</span> /etc/my.cnf
</code></pre>

<p>And commented out the bind-address</p>
<pre class=" language-bash"><code class="language-bash">
<span class="token comment" spellcheck="true">#bind-address   = 127.0.0.1</span>
</code></pre>

<p>I also enabled password less login for root user. So that while running the scripts, it will not ask for the password:</p>
<pre class=" language-bash"><code class="language-bash">
mysql_config_editor <span class="token keyword">set</span> --login-path<span class="token operator">=</span>client --host<span class="token operator">=</span>localhost --user<span class="token operator">=</span>root –password
</code></pre>

<p>I used HeidiSQL 9.4.0.5125 as the front-end management component for managing MySQL databases. Creating the Database:</p>
<pre class=" language-bash"><code class="language-bash">
mysql -u root -e <span class="token string">"CREATE DATABASE IF NOT EXISTS testdb;"</span>
mysql -u root -e <span class="token string">"CREATE USER 'usr'@'%' IDENTIFIED BY 'passwd';"</span>
mysql -u root -e <span class="token string">"GRANT ALL PRIVILEGES ON testdb.* TO 'usr'@'%';"</span>
mysql -u root -e "FLUSH PRIVILEGES<span class="token punctuation">;</span>

</code></pre>

<h4 id="MSSQL-DB"><a href="#MSSQL-DB" class="headerlink" title="MSSQL DB:"></a>MSSQL DB:</h4><p>Creating the Database:</p>
<pre class=" language-powershell"><code class="language-powershell">
<span class="token namespace">[reflection.assembly]</span>::LoadWithPartialName<span class="token punctuation">(</span><span class="token string">"Microsoft.SqlServer.Smo"</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">Out-Null</span>

<span class="token variable">$currenthost</span> = hostname

<span class="token variable">$defaultInstance</span> = <span class="token string">"notdefault"</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$defaultInstance</span> <span class="token operator">-eq</span> <span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ServerName</span> = <span class="token string">"<span class="token variable">$currenthost</span>"</span>
<span class="token punctuation">}</span>
<span class="token keyword">Else</span><span class="token punctuation">{</span>
    <span class="token variable">$ServerName</span> = <span class="token string">"<span class="token variable">$currenthost</span>\\SHAREDINS"</span>
<span class="token punctuation">}</span>

<span class="token variable">$server</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName Microsoft<span class="token punctuation">.</span>SQLServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Server <span class="token variable">$ServerName</span>

<span class="token variable">$dbExists</span> = <span class="token boolean">$FALSE</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$individual_db</span> in <span class="token variable">$server</span><span class="token punctuation">.</span>databases<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$individual_db</span><span class="token punctuation">.</span>name <span class="token operator">-eq</span> <span class="token string">"testdb"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database already exists."</span>
    <span class="token variable">$dbExists</span> = <span class="token boolean">$TRUE</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$dbExists</span> <span class="token operator">-eq</span> <span class="token boolean">$FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token variable">$login</span> = <span class="token function">New-Object</span> Microsoft<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Login <span class="token operator">-</span>ArgumentList <span class="token variable">$ServerName</span><span class="token punctuation">,</span> <span class="token string">"usr"</span>
    <span class="token variable">$login</span><span class="token punctuation">.</span>LoginType = <span class="token string">'SqlLogin'</span>
    <span class="token variable">$login</span><span class="token punctuation">.</span>PasswordPolicyEnforced = <span class="token boolean">$false</span>
    <span class="token variable">$login</span><span class="token punctuation">.</span>PasswordExpirationEnabled = <span class="token boolean">$false</span>
    <span class="token variable">$login</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token string">'passwd'</span><span class="token punctuation">)</span>
    <span class="token function">Write-Host</span> <span class="token string">"Login usr created"</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Can not create Login usr"</span>
    <span class="token keyword">exit</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token variable">$database</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName Microsoft<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Database <span class="token operator">-</span>argumentlist <span class="token variable">$server</span><span class="token punctuation">,</span> <span class="token string">"testdb"</span>
    <span class="token variable">$database</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database testdb created"</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database testdb cannot be created"</span>
    <span class="token keyword">exit</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token variable">$user</span> = <span class="token string">"usr"</span>
    <span class="token variable">$db_user</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName Microsoft<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>User <span class="token operator">-</span>argumentlist <span class="token variable">$database</span><span class="token punctuation">,</span> <span class="token variable">$user</span>
    <span class="token variable">$db_user</span><span class="token punctuation">.</span>Login = <span class="token variable">$user</span>
    <span class="token variable">$db_user</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database user usr created"</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database user usr cannot be created"</span>
    <span class="token keyword">exit</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token variable">$server</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName Microsoft<span class="token punctuation">.</span>SQLServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Server <span class="token variable">$ServerName</span>
    <span class="token variable">$data</span> = <span class="token function">New-Object</span> Microsoft<span class="token punctuation">.</span>SqlServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Database
    <span class="token variable">$data</span> = <span class="token variable">$server</span><span class="token punctuation">.</span>Databases<span class="token punctuation">.</span>Item<span class="token punctuation">(</span><span class="token string">'testdb'</span><span class="token punctuation">)</span>
    <span class="token variable">$data</span><span class="token punctuation">.</span>SetOwner<span class="token punctuation">(</span><span class="token string">'usr'</span><span class="token punctuation">,</span> <span class="token boolean">$TRUE</span><span class="token punctuation">)</span>
    <span class="token variable">$data</span><span class="token punctuation">.</span>Alter<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Write-Host</span> <span class="token string">"Database owner changed to usr"</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">catch</span><span class="token punctuation">{</span>
    <span class="token function">Write-Host</span> <span class="token string">"Cannot set database ownership to usr"</span>
    <span class="token variable">$database</span><span class="token punctuation">.</span>Drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token variable">$db_user</span><span class="token punctuation">.</span>Drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token variable">$login</span><span class="token punctuation">.</span>Drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">exit</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<h4 id="Database-deletion-scripts"><a href="#Database-deletion-scripts" class="headerlink" title="Database deletion scripts:"></a>Database deletion scripts:</h4><p>I used the following scripts to delete the databases</p>
<h4 id="PostgreSQL-1"><a href="#PostgreSQL-1" class="headerlink" title="PostgreSQL:"></a>PostgreSQL:</h4><pre class=" language-bash"><code class="language-bash">
<span class="token function">su</span> - postgres -c <span class="token string">"dropdb POSTGRESQLDB"</span>
<span class="token function">su</span> - postgres -c <span class="token string">"dropuser POSTGREUSER"</span>
</code></pre>

<h4 id="MySQL-DB-1"><a href="#MySQL-DB-1" class="headerlink" title="MySQL DB:"></a>MySQL DB:</h4><pre class=" language-bash"><code class="language-bash">
mysql -u root -e <span class="token string">"DROP DATABASE MYSQLDB;"</span>
mysql -u root -e <span class="token string">"DROP USER 'MYSQLUSER'@'%';"</span>
</code></pre>

<h4 id="MSSQL-DB-1"><a href="#MSSQL-DB-1" class="headerlink" title="MSSQL DB:"></a>MSSQL DB:</h4><pre class=" language-powershell"><code class="language-powershell">
<span class="token namespace">[reflection.assembly]</span>::LoadWithPartialName<span class="token punctuation">(</span><span class="token string">"Microsoft.SqlServer.Smo"</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">Out-Null</span>

<span class="token variable">$currenthost</span> = hostname

<span class="token variable">$defaultInstance</span> = <span class="token string">"yes"</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$defaultInstance</span> <span class="token operator">-eq</span> <span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ServerName</span> = <span class="token string">"<span class="token variable">$currenthost</span>"</span>
<span class="token punctuation">}</span>
<span class="token keyword">Else</span><span class="token punctuation">{</span>
    <span class="token variable">$ServerName</span> = <span class="token string">"<span class="token variable">$currenthost</span>\\MSSQLINSTANCE"</span>
<span class="token punctuation">}</span>

<span class="token variable">$server</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>TypeName Microsoft<span class="token punctuation">.</span>SQLServer<span class="token punctuation">.</span>Management<span class="token punctuation">.</span>Smo<span class="token punctuation">.</span>Server <span class="token variable">$ServerName</span>

<span class="token variable">$DatabaseName</span> = <span class="token string">"sajalmsdb"</span>
<span class="token variable">$DatabaseUser</span> = <span class="token string">"sajal"</span>

<span class="token function">Write-Host</span> <span class="token variable">$DatabaseName</span>
<span class="token function">Write-Host</span> <span class="token variable">$DatabaseUser</span>

<span class="token variable">$DBObject</span> = <span class="token variable">$Server</span><span class="token punctuation">.</span>Databases\<span class="token punctuation">[</span><span class="token variable">$DatabaseName</span>\<span class="token punctuation">]</span>

<span class="token function">Write-Host</span> <span class="token variable">$DBObject</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$DBObject</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token variable">$Server</span><span class="token punctuation">.</span>KillDatabase<span class="token punctuation">(</span><span class="token variable">$DatabaseName</span><span class="token punctuation">)</span>
  <span class="token function">Write-Host</span> <span class="token string">"Deleted the Database"</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$Server</span><span class="token punctuation">.</span>Logins<span class="token punctuation">.</span>Contains<span class="token punctuation">(</span><span class="token variable">$DatabaseUser</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
   <span class="token variable">$Server</span><span class="token punctuation">.</span>Logins\<span class="token punctuation">[</span><span class="token variable">$DatabaseUser</span>\<span class="token punctuation">]</span><span class="token punctuation">.</span>Drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token function">Write-Host</span> <span class="token string">"Deleted the user login"</span>
 <span class="token punctuation">}</span>
</code></pre>

<p>Please note: <span style="color:red"><strong>NOT A SECURITY BEST PRACTICE</strong>. <strong>Do not do it in production</strong></span>. I only did it for PoC environment.</p>
<h4 id="The-Video"><a href="#The-Video" class="headerlink" title="The Video:"></a>The Video:</h4><p>Please watch the following video for a detailed demo and further explanation. </p>
<div class="video-container"><iframe src="//www.youtube.com/embed/1aoGHALKiv8" frameborder="0" allowfullscreen></iframe></div>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion:"></a>Conclusion:</h4><p>This concludes this particular use case “Shared DB as a Service”. Please remember, the workflows I created are for PoC purpose only. My primary aim was to create the structure with the functionalities. Since the structure is ready, you can change the structure to suit your need. The vRA and vRO part is pretty much ok. I would strongly suggest the change or change the Database creation, change, and Deletion Shell/PowerShell scripts to make those more robust.   I specifically made this use case to show that you can do amazing things with vRealize Automation. It is a tool using which you can build whatever you want. When you have the tool you do not need everything out of the box. You can build your own items. With this thought, I am closing this post.  Till the next one, keep safe and happy automating!!!!</p>

   </div>
  </div>
     <div class="card-footer">
        <b>Share this Post &emsp; </b>
          
<a class="card-link" href="http://www.facebook.com/sharer.php?u=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Facebook" src="/facebook.svg" width="25" height="25">
</a>
<a class="card-link" href="http://www.linkedin.com/shareArticle?mini=true&url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="LinkedIn" src="/linkedin.svg" width="25" height="25">
</a>
<a class="card-link" href="http://twitter.com/intent/tweet?text=An%20intersting%20blog&url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Twitter" src="/twitter.svg" width="25" height="25">
</a>
<a class="card-link" href="https://plus.google.com/share?url=https://sajaldebnath.com/ootb-shared-db-as-a-service-complete-with-day-2-operations.html" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;">
  <img border="0" alt="Goolge+" src="/google-plus.svg" width="25" height="25">
</a>

     </div>
</div>
<!-- Comments Section -->

<section class="comments">
  <div class="card">
    <div class="card-header">
      <b>Comments</b>
    </div>
    <div class="card-block">
      <div class="card-text">
        
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>


      </div>
    </div>
  </div>
</section>


      </div>
      <!-- Right Side Space -->
      <div class="clr-col-xs-12 clr-col-sm-12 clr-col-md-12 clr-col-lg-12 clr-col-xl-3">
      </div>
  </div>
</div>
</div>

      

  </clr-main-container>

  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-84051711-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-84051711-1');
  gtag('set', {'user_id': 'UA-84051711-1'}); // Set the user ID using signed-in user_id.
</script>

  <!-- Including the Scripts Area -->
  <script src="/js/jquery-3.3.1.slim.min.js" async></script>
  <script>window.jQuery || document.write('<script src="/js/jquery-3.3.1.slim.min.js"><\/script>')</script>

  <noscript>
    Sorry...JavaScript is needed to go ahead.
  </noscript>

  <!-- Defining the scripts -->
  <script type="text/javascript">

    // Handling the main header menubar options in Responsive mode
    $(".header-hamburger-trigger").on('click',function(){
      if($(".main-container").hasClass("open-hamburger-menu")){
        $(".main-container").removeClass("open-hamburger-menu");
      }else{
      $(".main-container").addClass("open-hamburger-menu");
    }
    });

  </script>
  <!-- Disqus Comments -->
  
    <script type="text/javascript">
        var disqus_shortname = 'sajaldebnath';
        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>
  

</body>
</html>
